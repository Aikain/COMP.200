Tässä luvussa käsitellään joitakin havaittuja virheitä, joita käyttäjä on mahdollisesti
voinut tehdä käyttäessään Ansiblela. Suuri painotus virheissä on nimenomaan
tietoturvahajuilla. Valitut virheet eivät ole välttämättä yleisimpiä tai muutenkaan
tärkeimpiä vaan ne ovat valittu mielenkiintoisuuden kannalta. Lopussa esitellään myös
yksi keino havaita mahdollisia virheitä.

\section{Tietoturvahajut}

TODO: jotain yleistä tietoturvahajuista

\subsection{Kovakoodatut salaisuudet}

Selvästi yleisin havaituista tietoturvahajuista on kovakoodatut salaisuudet. Kovakoodatuissa
salaisuuksissa palajstetaan yleenseä selvätekstisenä joitakin arkaluontoisia tietoja, kuten
käyttäjätunnuksia ja salasanoja. \parencite{RahmanAkond2019TSSS}

Kovakoodatut salaisuudet ovat yksinkertaisimmillaan sitä, että tehtävän vaatima salaisuus
kirjoitetaan suoraan tehtävän yhteydeen ja on kenen tahansa luettavissa, joka pääsee käsiksi
koodiin. Ongelma on havannollistettu esimerkissä  \ref{lst:hardcoded-secret}.

\lstinputlisting[
  basicstyle=\small,
  caption={Esimerkki kovakoodatusta salasanasta},
  label={lst:hardcoded-secret}
]{code/hardcoded-secret.yaml}

Yksinkertaisuutensa vuoksi ei ole yllättävää, että salasanat tulee helposti kovakoodattua
suoraan tehtävälle. Vaikka salasana tulisikin muuttujan kautta, ei ratkaisu suoraan ole
parempi, mikäli muuttujan sisältö on yhä selvätekstisenä luettavissa. Onkin suositeltavaa
käyttää holveja apuna salaasamaan salaisuuksia \parencite{RahmanAkond2019TSSS}. Pystymme
Ansible Vaultin avulla salaamaan muuttujia ja tiedostoja. Kyseinen salaus perustuu siihen,
että salauksen purkamiseen tarvitaan erillinen avain, joka jaetaan erikseen sen tarvitseville.
Tällöin voidaan varsinainen salaisuus pitää koodin mukana. Esimerkki Ansible Vaultin käytöstä
on esitetty esimerkissä \ref{lst:secret-with-ansible-vault}. Kuten esimerkistä nähdään,
ei salaisuutta pysty suorilta käsiltä näkemään. Salaisuus ei ole myöskään selvitettävissä
ohjelmallisesti ilman salauksen purkamiseen tarvittavaa avainta.

\lstinputlisting[
  basicstyle=\small,
  caption={Esimerkki Ansible Vaultilla suojatusta salaisuudesta},
  label={lst:secret-with-ansible-vault},
]{code/secret-with-ansible-vault.yaml}

Mahdollisen syyn kovakoodatuille salaisuuksille voivat muodostaa salaisuuksien salaamisen
tuoma ylimääräinen vaihe sekä dokumentaatiossa olevien esimerkkien yksinkertaisuus. Aiemmin
esitetty esimerkki \ref{lst:hardcoded-secret} on vastaava kuin mitä suoraan dokumentaatiosta
\parencite{AnsibleDocs} on löydettävissä. Dokumentaatio pyrkii toki olemaan tehtävien
toiminnallisuuden kannalta yksinkertainen, joten on ymmärrettävää, ettei kyseisen tehtävän
esimerkeissä ole lähdetty esittelemään tehtävään suoraan liittymättömän toiminnallisuuden
käyttöä.

\subsection{Eheystarkistuksen puuttuminen}

Tiedostojen eheyden tarkistuksessa voidaan käyttää tarkistussummia. Eheyden tarkistamisella
pyritään varmistamaan, että tiedostoa ei ole muutettua sen luonnin jälkeen. Tarkistussumma
on yleensä 128–512 bittiä pitkä kiinteän pituinen merkkijono riippumatta tiedoston sisällön
pituudesta. Saman tarkistussumman luominen muutetulla tiedoston sisällöllä (esimerkiksi
mukaan ujutetulla haittaojelmalla) vaatisi raa'an voiman hyökkäykseen, jonka seurauksena se
on käytännössä mahdotonta. \parencite{MeylanAlexandre2020ASot}

Mikäli eheyttä ei tarkisteta, tehdään oletus, että tiedosto on aina turvallinen eikä ole
mahdollisesti korruptoitu hyökkääjän toimesta \parencite{RahmanAkond2021SSiA}. Esimerkki
tällaisesta oletuksesta on mahdollista toteuttaa esimerkin
\ref{lst:file-download-without-checksum} mukaisesti. Esimerkistä ei huomaa tarkistussumman
puuttumista, mikäli ei ole perehtynyt tarkemmin dokumentaatioon, jossa se mainitaan.

\lstinputlisting[
  basicstyle=\small,
  caption={Esimerkki tiedoston lataamisesta ilman tarkistussummaa},
  label={lst:file-download-without-checksum},
]{code/file-download-without-checksum.yaml}

Tarkistussumman lisääminen on tehty monesti hyvinkin yksinkertaisesti. Aiempaan esimerkkiin
\ref{lst:file-download-without-checksum} saadaan lisättyä tarkistussumma lisäämällä
yksittäinen rivi, kuten esimerkissä \ref{lst:file-download-with-checksum} näytetään.

\lstinputlisting[
  basicstyle=\small,
  caption={Esimerkki tiedoston lataamisesta tarkistussummalla},
  label={lst:file-download-with-checksum},
]{code/file-download-with-checksum.yaml}

Mikäli tarkistussummaa ei tarjota valmiiksi, voi sen esimerkiksi generoida siihen tehdyllä
komennolla \parencite{Sha256sumManPage}.

\begin{lstlisting}[
  basicstyle=\small,
  label={lst:sha256sum-example},
  language=bash
]
    $ sha256sum example.txt
\end{lstlisting}

Mikäli tarkistussumma ladataan täysin samasta paikasta kuin tiedostokin, on mahdollista, että
jos tiedosto saadaan korruptoitua, voidaan myös tarkistussumma korruptoida. Tämän vuoksi voisi
olla suositeltavaa määritellä yksittäisen tiedoston latauksessa tarkistussumma suoraan kuten
esimerkissä \ref{lst:file-download-with-checksum} ilman että tarkistussummakin haetaan muualta.

\section{Muita virheitä}

asdf

\section{Virheiden automaattinen tunnistaminen}
